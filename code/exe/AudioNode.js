// MINIFIED VERSION OF THE FILE OF THE SAME NAME IN THE `src` FOLDER
// MINIFIED WITH https://www.toptal.com/developers/javascript-minifier
// MINIFIED AT Tue Jun  3 16:31:05 CDT 2025

export class AudioNode{constructor(e,t,o){this.audioCtx=t,this.elements=[],this.elements.push(o),this.playing=!1,this.volume=.25,this.loaded=0,this.error=!1,this.src=e,this.data=new ArrayBuffer,this.source,this.noise,window.addEventListener("beforeunload",()=>this.shutdown())}async load(){for(var e of(this.loaded=1,this.elements))e.style.backgroundColor="#8800cc";async function t(e){try{let t=await fetch(e,{method:"HEAD",cache:"no-store"});return t.ok}catch(o){return console.error("Error checking file:",o),!1}}if(this.lock(),!await t(this.src)){this.error=!0,console.error(`Error loading ${this.src}`),this.elements.forEach((e,t)=>{e.style.backgroundColor="#ff0000"});return}var o,i=this.elements[0].querySelectorAll(".SLIDER")[0].value,s=new XMLHttpRequest;s.open("GET",this.src,!0),s.responseType="arraybuffer",s.onload=function(e){o=this.response},s.onprogress=e=>{for(var t of this.elements)t.querySelectorAll(".SLIDER")[0].value=e.loaded/e.total*100},s.onloadend=e=>{console.debug("ArrayBuffer loaded successfully:",o)},s.send(),await new Promise(e=>{console.log(s),s.onloadend=()=>e()});let r=o;for(let a of this.elements)a.querySelectorAll(".SLIDER")[0].value=i;this.loaded=2,this.data=await this.audioCtx.decodeAudioData(r),this.source=await this.audioCtx.createBufferSource(),this.source.buffer=this.data,this.source.loop=!0,this.loaded=3,this.noise=await this.audioCtx.createGain(),await this.source.connect(this.noise),this.noise.gain.setValueAtTime(0,this.audioCtx.currentTime),await this.noise.connect(window.amplifier),this.loaded=4,await this.source.start(),await this.noise.disconnect(),this.loaded=5,this.unlock(),console.debug(`${this.src} - Finished loading data for AudioNode`)}async play(){if(0==this.loaded&&await this.load(),5==this.loaded){for(var e of this.elements)e.style.backgroundColor="#999999";this.noise.gain.setValueAtTime(0,this.audioCtx.currentTime),await this.noise.connect(window.amplifier),this.noise.gain.setTargetAtTime(this.volume,this.audioCtx.currentTime,.183),this.playing=!0,this.cloneToPlaying(),console.debug(`${this.src} - Started Playback of AudioNode`),window.URIsaver.save()}}async stop(){if(0==this.loaded&&await this.load(),5==this.loaded){for(var e of this.elements)e.style.backgroundColor="#555555";this.noise.gain.setTargetAtTime(0,this.audioCtx.currentTime,.183),this.lock(),console.debug(`${this.src} - Started Shutdown of AudioNode`),window.setTimeout(()=>{this.noise.disconnect(),this.playing=!1,this.unlock(),console.debug(`${this.src} - Halted Playback of AudioNode`),window.URIsaver.save()},1e3)}}async toggle(e){if(e&&!(performance.timing.navigationStart+e.timeStamp+250>=Date.now())){console.debug("Alert blocked execution for too long. Aborting.");return}!1==this.playing?await this.play():await this.stop()}async adjustVolume(e,t){if(this.volume=e,this.noise&&this.noise.gain.setValueAtTime(this.volume,this.audioCtx.currentTime),t)for(var o of this.elements)o.querySelectorAll(".SLIDER")[0].value=t;else for(var o of this.elements)o.querySelectorAll(".SLIDER")[0].value=100*Math.cbrt(e)}lock(){for(var e of this.elements)e.querySelectorAll(".audioButton")[0].setAttribute("disabled",""),e.querySelectorAll(".SLIDER")[0].setAttribute("disabled","")}unlock(){for(var e of this.elements)e.querySelectorAll(".audioButton")[0].removeAttribute("disabled"),e.querySelectorAll(".SLIDER")[0].removeAttribute("disabled")}async shutdown(){if(this.loaded>0){try{this.source.stop()}catch(e){console.error(e)}try{this.noise.disconnect()}catch(t){console.error(t)}try{this.source.disconnect()}catch(o){console.error(o)}console.debug(`${this.src} - Shutdown AudioNode`)}}async addPointer(e){this.elements.push(e)}async cloneToPlaying(){var e=Array.from(document.querySelectorAll(".audioContainer")).filter(e=>!!e.audioNode&&e.audioNode.src===this.src)[0];if(!Array.from(document.querySelectorAll("#recentGrid .audioContainer")).map(e=>e.audioNode?e.audioNode.src:"NULL SOURCE").some(e=>e===this.src)){var t=e.cloneNode(!0);e.audioNode.addPointer(t),t.audioNode=e.audioNode,t.querySelector("button").addEventListener("click",e=>{t.audioNode.toggle(e)}),t.querySelector("input").addEventListener("input",e=>t.audioNode.adjustVolume(2*(e.target.value/100)**3,e.target.value)),t.querySelector("input").addEventListener("change",e=>window.URIsaver.save()),document.querySelector("#recentGrid").insertAdjacentElement("afterbegin",t),Array.from(document.querySelectorAll(".recentSection")).forEach((e,t)=>{e.classList.remove("recentSection")})}}}