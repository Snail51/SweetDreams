<!DOCTYPE html>
<html>
    <head>
        <meta charset='utf-8'>
        <title>Sweet Dreams</title>
        <link rel="icon" href="./Resources/js_icon.jpg" type="jpg">

        <!-- Consumes custom <AudioNode> elements and initializes all their logic and DOM elements -->
        <script type="module">
            import { AudioNode } from "./audionode.js";
            window.audioCTX = new window.AudioContext();
            window.audioNodes = new Array();

            var audioNodeDOMs = document.querySelectorAll("AudioNode");
            console.log(audioNodeDOMs);
            for( var node of audioNodeDOMs )
            {
                // capture DOM element attributes
                const name = node.getAttribute("name");
                const src = node.getAttribute("src");

                // create new AudioNode object
                var newNode = new AudioNode(src, window.audioCTX);
                window.audioNodes.push(newNode);
                const nodeIndex = window.audioNodes.length-1;

                // create new div object
                var newDiv = document.createElement("div");
                newDiv.className = "audioContainer";

                // create new button object
                var newButton = document.createElement("button");
                newButton.innerHTML = name;
                newButton.addEventListener("click", () => window.audioNodes[nodeIndex].toggle());

                // create new <input> of type `range`
                var newRange = document.createElement("input");
                newRange.type = "range";
                newRange.addEventListener("input", () => window.audioNodes[nodeIndex].adjustVolume(event.target.value/100));

                // insert the elements into the div
                newDiv.appendChild(newButton);
                newDiv.appendChild(newRange);

                // place the new div structure onto the DOM
                node.insertAdjacentElement("afterend", newDiv);
            }
        </script>

        <style>
            .audioContainer {
                width: 150px;
                height: 150px;
                display: flex;
                flex-direction: column;
                padding: 1%;

                background-color: red;
            }
            .audioContainer > :nth-child(1) {
                flex: 4;
            }
            .audioContainer > :nth-child(2) {
                flex: 1;
            }
        </style>
    </head>
    <body style="background-color: rgb(44, 46, 54); color: whitesmoke; font-size: 24px;">
        <h1>Sweet Dreams</h1>

        <AudioNode src="/audiosrc/OVERLAP.mp3" name="Overlap Sound"></AudioNode>
        <AudioNode src="/audiosrc/Stream-B.wav" name="Stream (Brendan)"></AudioNode>

        
    </body>
</html>
